{
 "Resources": {
  "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFD8B12F67F": {
   "Type": "AWS::SecretsManager::Secret",
   "Properties": {
    "Description": {
     "Fn::Join": [
      "",
      [
       "Generated by the CDK for stack: ",
       {
        "Ref": "AWS::StackName"
       }
      ]
     ]
    },
    "GenerateSecretString": {
     "ExcludeCharacters": " %+~`#$&*()|[]{}:;<>?!'/@\"\\",
     "GenerateStringKey": "password",
     "PasswordLength": 30,
     "SecretStringTemplate": "{\"username\":\"clusteradmin\"}"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/RDSDatabaseForAgentWithFD/AuroraSecretForAgentWithFD/Resource"
   }
  },
  "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFDAttachment4D738340": {
   "Type": "AWS::SecretsManager::SecretTargetAttachment",
   "Properties": {
    "SecretId": {
     "Ref": "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFD8B12F67F"
    },
    "TargetId": {
     "Ref": "RDSDatabaseForAgentWithFDAuroraClusterForAgentWithFD382D4012"
    },
    "TargetType": "AWS::RDS::DBCluster"
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/RDSDatabaseForAgentWithFD/AuroraSecretForAgentWithFD/Attachment/Resource"
   }
  },
  "RDSDatabaseForAgentWithFDAuroraClusterForAgentWithFD382D4012": {
   "Type": "AWS::RDS::DBCluster",
   "Properties": {
    "CopyTagsToSnapshot": true,
    "DBClusterIdentifier": "agent-with-fd-aurora-cluster",
    "DBClusterParameterGroupName": "default.aurora-postgresql13",
    "DatabaseName": "employeedatabase",
    "EnableHttpEndpoint": true,
    "Engine": "aurora-postgresql",
    "EngineMode": "serverless",
    "EngineVersion": "13.12",
    "MasterUserPassword": {
     "Fn::Join": [
      "",
      [
       "{{resolve:secretsmanager:",
       {
        "Ref": "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFD8B12F67F"
       },
       ":SecretString:password::}}"
      ]
     ]
    },
    "MasterUsername": {
     "Fn::Join": [
      "",
      [
       "{{resolve:secretsmanager:",
       {
        "Ref": "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFD8B12F67F"
       },
       ":SecretString:username::}}"
      ]
     ]
    },
    "StorageEncrypted": true,
    "VpcSecurityGroupIds": []
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/RDSDatabaseForAgentWithFD/AuroraClusterForAgentWithFD/Resource"
   }
  },
  "RDSDatabaseForAgentWithFDLambdaRoleToPopulateData3DFAB4C7": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Description": "Execution Role for Lambda function",
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     },
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/AmazonRDSDataFullAccess"
       ]
      ]
     }
    ],
    "Policies": [
     {
      "PolicyDocument": {
       "Statement": [
        {
         "Action": "secretsmanager:GetSecretValue",
         "Effect": "Allow",
         "Resource": {
          "Ref": "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFD8B12F67F"
         }
        }
       ],
       "Version": "2012-10-17"
      },
      "PolicyName": "AllowAccessSecretManager"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/RDSDatabaseForAgentWithFD/LambdaRoleToPopulateData/Resource"
   }
  },
  "RDSDatabaseForAgentWithFDPopulateSampleDataFuncB4C9989C": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-533267284022-us-east-1",
     "S3Key": "0468814c137be54266082c63a9e0c80153e84d41568eeec0bd57770c2cb7574a.zip"
    },
    "Environment": {
     "Variables": {
      "CLUSTER_ARN": {
       "Fn::Join": [
        "",
        [
         "arn:aws:rds:us-east-1:533267284022:cluster:",
         {
          "Ref": "RDSDatabaseForAgentWithFDAuroraClusterForAgentWithFD382D4012"
         }
        ]
       ]
      },
      "SECRET_ARN": {
       "Ref": "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFDAttachment4D738340"
      }
     }
    },
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "RDSDatabaseForAgentWithFDLambdaRoleToPopulateData3DFAB4C7",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 300
   },
   "DependsOn": [
    "RDSDatabaseForAgentWithFDLambdaRoleToPopulateData3DFAB4C7"
   ],
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/RDSDatabaseForAgentWithFD/PopulateSampleDataFunc/Resource",
    "aws:asset:path": "asset.0468814c137be54266082c63a9e0c80153e84d41568eeec0bd57770c2cb7574a",
    "aws:asset:is-bundled": true,
    "aws:asset:property": "Code"
   }
  },
  "RDSDatabaseForAgentWithFDTriggerPopulateDataFunction0445536E": {
   "Type": "Custom::AWS",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
      "Arn"
     ]
    },
    "Create": {
     "Fn::Join": [
      "",
      [
       "{\"service\":\"Lambda\",\"action\":\"InvokeCommand\",\"parameters\":{\"FunctionName\":\"",
       {
        "Ref": "RDSDatabaseForAgentWithFDPopulateSampleDataFuncB4C9989C"
       },
       "\",\"Payload\":\"{\\\"message\\\":\\\"Populate data in RDS\\\"}\"},\"physicalResourceId\":{\"id\":\"1722525463830\"}}"
      ]
     ]
    },
    "Update": {
     "Fn::Join": [
      "",
      [
       "{\"service\":\"Lambda\",\"action\":\"InvokeCommand\",\"parameters\":{\"FunctionName\":\"",
       {
        "Ref": "RDSDatabaseForAgentWithFDPopulateSampleDataFuncB4C9989C"
       },
       "\",\"Payload\":\"{\\\"message\\\":\\\"Populate data in RDS\\\"}\"},\"physicalResourceId\":{\"id\":\"1722525463830\"}}"
      ]
     ]
    },
    "InstallLatestAwsSdk": true
   },
   "DependsOn": [
    "RDSDatabaseForAgentWithFDTriggerPopulateDataFunctionCustomResourcePolicy651A2782"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/RDSDatabaseForAgentWithFD/TriggerPopulateDataFunction/Resource/Default"
   }
  },
  "RDSDatabaseForAgentWithFDTriggerPopulateDataFunctionCustomResourcePolicy651A2782": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "RDSDatabaseForAgentWithFDPopulateSampleDataFuncB4C9989C",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "RDSDatabaseForAgentWithFDTriggerPopulateDataFunctionCustomResourcePolicy651A2782",
    "Roles": [
     {
      "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/RDSDatabaseForAgentWithFD/TriggerPopulateDataFunction/CustomResourcePolicy/Resource"
   }
  },
  "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/Resource"
   }
  },
  "AWS679f53fac002430cb0da5b7982bd22872D164C4C": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-533267284022-us-east-1",
     "S3Key": "97f30e67419a1676a2215492723e5add1aa491caf0cbe2dd878fc4fab0468cd4.zip"
    },
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x",
    "Timeout": 120
   },
   "DependsOn": [
    "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"
   ],
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/AWS679f53fac002430cb0da5b7982bd2287/Resource",
    "aws:asset:path": "asset.97f30e67419a1676a2215492723e5add1aa491caf0cbe2dd878fc4fab0468cd4",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "VacationsActionGroupLambdaRoleAF8D096D": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Description": "Execution Role for Lambda function",
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     },
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/AmazonRDSDataFullAccess"
       ]
      ]
     }
    ],
    "Policies": [
     {
      "PolicyDocument": {
       "Statement": [
        {
         "Action": "secretsmanager:GetSecretValue",
         "Effect": "Allow",
         "Resource": "*"
        }
       ],
       "Version": "2012-10-17"
      },
      "PolicyName": "AllowAccessSecretManagerPolicy"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/VacationsActionGroup/LambdaRole/Resource"
   }
  },
  "VacationsActionGroupVacationsActionGroupLambdaFunction17AAB9FC": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-533267284022-us-east-1",
     "S3Key": "78c94766cabc590012fbfcc0950861ec901369c311e7ee65a0d20f6e60532213.zip"
    },
    "Environment": {
     "Variables": {
      "CLUSTER_ARN": {
       "Fn::Join": [
        "",
        [
         "arn:aws:rds:us-east-1:533267284022:cluster:",
         {
          "Ref": "RDSDatabaseForAgentWithFDAuroraClusterForAgentWithFD382D4012"
         }
        ]
       ]
      },
      "SECRET_ARN": {
       "Ref": "RDSDatabaseForAgentWithFDAuroraSecretForAgentWithFD8B12F67F"
      }
     }
    },
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "VacationsActionGroupLambdaRoleAF8D096D",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x",
    "Timeout": 900
   },
   "DependsOn": [
    "VacationsActionGroupLambdaRoleAF8D096D"
   ],
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/VacationsActionGroup/VacationsActionGroupLambdaFunction/Resource",
    "aws:asset:path": "asset.78c94766cabc590012fbfcc0950861ec901369c311e7ee65a0d20f6e60532213",
    "aws:asset:is-bundled": true,
    "aws:asset:property": "Code"
   }
  },
  "VacationsActionGroupVacationsActionGroupLambdaFunctionBedrockAgentInvokePermission9fc670c3634E8F3A0B2": {
   "Type": "AWS::Lambda::Permission",
   "Properties": {
    "Action": "lambda:InvokeFunction",
    "FunctionName": {
     "Fn::GetAtt": [
      "VacationsActionGroupVacationsActionGroupLambdaFunction17AAB9FC",
      "Arn"
     ]
    },
    "Principal": "bedrock.amazonaws.com",
    "SourceArn": {
     "Fn::GetAtt": [
      "AmazonBedrockAgentBlueprintsStackAgentBlueprinthrassistantagentwithfunctiondefinition1D2A9A47",
      "AgentArn"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/VacationsActionGroup/VacationsActionGroupLambdaFunction/BedrockAgentInvokePermission-9fc670c3-634"
   }
  },
  "AmazonBedrockAgentBlueprintsStackBedrockServiceRole55949A6B": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Condition": {
        "StringEquals": {
         "aws:SourceAccount": {
          "Ref": "AWS::AccountId"
         }
        }
       },
       "Effect": "Allow",
       "Principal": {
        "Service": "bedrock.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Description": "Service role for Amazon Bedrock",
    "RoleName": "AmazonBedrockExecutionRoleForAgents_308988c6-186"
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/AmazonBedrockAgentBlueprintsStack/BedrockServiceRole/Resource"
   }
  },
  "AmazonBedrockAgentBlueprintsStackBedrockServiceRoleDefaultPolicy52DAA442": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "bedrock:InvokeModel",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:aws:bedrock:",
          {
           "Ref": "AWS::Region"
          },
          "::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0"
         ]
        ]
       },
       "Sid": "AllowModelInvocationForOrchestration"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AmazonBedrockAgentBlueprintsStackBedrockServiceRoleDefaultPolicy52DAA442",
    "Roles": [
     {
      "Ref": "AmazonBedrockAgentBlueprintsStackBedrockServiceRole55949A6B"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/AmazonBedrockAgentBlueprintsStack/BedrockServiceRole/DefaultPolicy/Resource"
   }
  },
  "AmazonBedrockAgentBlueprintsStackAgentBlueprinthrassistantagentwithfunctiondefinition1D2A9A47": {
   "Type": "AWS::Bedrock::Agent",
   "Properties": {
    "ActionGroups": [
     {
      "ActionGroupName": "UserInputAction",
      "ActionGroupState": "ENABLED",
      "ParentActionGroupSignature": "AMAZON.UserInput"
     },
     {
      "ActionGroupExecutor": {
       "Lambda": {
        "Fn::GetAtt": [
         "VacationsActionGroupVacationsActionGroupLambdaFunction17AAB9FC",
         "Arn"
        ]
       }
      },
      "ActionGroupName": "VacationsActionGroup",
      "ActionGroupState": "ENABLED",
      "Description": "Actions for getting the number of available vacations days for an employee and confirm new time off",
      "FunctionSchema": {
       "Functions": [
        {
         "Description": "Get the number of vacation days available for a certain employee",
         "Name": "get_available_vacation_days",
         "Parameters": {
          "employee_id": {
           "Description": "The ID of the employee to get the available vacations",
           "Required": true,
           "Type": "integer"
          }
         }
        },
        {
         "Description": "Reserve vacation time for a specific employee - you need all parameters to reserve vacation time",
         "Name": "reserve_vacation_time",
         "Parameters": {
          "employee_id": {
           "Description": "The ID of the employee to reserve the vacation time for",
           "Required": true,
           "Type": "integer"
          },
          "start_date": {
           "Description": "The start date of the vacation time to reserve",
           "Required": true,
           "Type": "integer"
          },
          "end_date": {
           "Description": "The end date of the vacation time to reserve",
           "Required": true,
           "Type": "integer"
          }
         }
        }
       ]
      }
     }
    ],
    "AgentName": "hr-assistant-agent-with-function-definition",
    "AgentResourceRoleArn": {
     "Fn::GetAtt": [
      "AmazonBedrockAgentBlueprintsStackBedrockServiceRole55949A6B",
      "Arn"
     ]
    },
    "FoundationModel": "anthropic.claude-3-sonnet-20240229-v1:0",
    "IdleSessionTTLInSeconds": 1200,
    "Instruction": "As an HR agent, your role involves assisting employees with a range of HR tasks. These include managing vacation requests both present and future, reviewing past vacation usage, tracking remaining vacation days, and addressing general HR inquiries. You will rely on contextual details provided by employees to fulfill their HR needs efficiently. When discussing dates, always use the YYYY-MM-DD format unless clarified otherwise by the employee. If you are unsure about any details, do not hesitate to ask the employee for clarification.Use \"you\" to address the employee directly, making it more personal and actionable.Make sure the responses are direct, straightforward, and do not contain unnecessary information.",
    "PromptOverrideConfiguration": {
     "PromptConfigurations": []
    },
    "TestAliasTags": {}
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/AmazonBedrockAgentBlueprintsStack/AgentBlueprint-hr-assistant-agent-with-function-definition"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/11Ry26EMAz8lt6zLt2qHwCseqwq6B2F4NJAHlIcdlUh/r1OFlFpT+MZ2/HYOcPLWwHFk7zRSQ3zyege1jZKNQuWujUMBOtFRtlLwhZVwChaDFcMBolqs1DEIOpvd6l2sgnKZWSlkyMGWDl7dCb4kmHEWEae8mPRRXEUPGY2oaWFtfEGU1HGT2+0+k30Hm3CSNsPsnN+wIngI8P74lTU3gl67SQR24EyAXOoFjVjrHihvTVbPDpa7UaD0f8rR5CGYrCaiNkmehyCVzOwXI7ZboPkl6BQ5GF8x5EfE4oP420X9iRbuVGdtaP+kfKye7yJtBhM9Hw9F/xb/FkTaX0Ki4vaIjR3/AP9jYpMyQEAAA=="
   },
   "Metadata": {
    "aws:cdk:path": "AgentWithFunctionDefinitionStack/CDKMetadata/Default"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}